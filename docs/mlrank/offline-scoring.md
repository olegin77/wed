# Offline scoring stub (`@wt/mlrank`)

`@wt/mlrank` предоставляет детерминированный линейный скорер для витрин каталога,
который можно запускать оффлайн до появления полноценной ML-модели.

## Входные факторы

| Поле     | Диапазон | Описание |
|----------|----------|----------|
| `conv`   | 0..1     | Конверсия воронки (просмотр → заявка). |
| `rating` | 0..1     | Нормализованный средний рейтинг. |
| `profile`| 0..1     | Заполненность профиля и медиаматериалов. |
| `calendar` | 0..1   | Актуальность календаря доступности. |
| `price`  | 0..1     | Опциональный ценовой сигнал (штрафы/бонусы). |

Все факторы рекомендуется нормализовать на стороне хранилищ/ETL. Если `price`
не передан, скорер использует нулевой вес и сохраняет совместимость с ранними
интеграциями.

## Весовые коэффициенты

По умолчанию используются веса:

- `conv`: 0.55
- `rating`: 0.20
- `profile`: 0.20
- `calendar`: 0.05
- `price`: 0 (отключено)

Переопределить веса можно через второй аргумент функции `score()`. Например:

```ts
import { score } from "@wt/mlrank";

const rank = score(
  { conv: 0.6, rating: 0.8, profile: 0.7, calendar: 0.9 },
  { price: -0.1 }
);
```

## Контроль диапазона

Помощник `clampNormalized()` гарантирует возвращение значения в пределах 0..1 и
используется скорером автоматически, чтобы downstream-сервисы не проверяли
границы вручную.

## Онлайн-адаптация весов

Для оперативной подстройки влияния факторов между переобучениями модели
используйте модуль `@wt/mlrank/online/update` (см. `docs/mlrank/online-learning.md`).
Он позволяет применить события кликов/бронирований с контролем затухания и
ограничений, сохраняя совместимость с оффлайн-скорером.

## Зависимости

- Источники факторов: см. `infra/feast/extract-features.ts` (T-1011).
- Пересчёт рангов: см. `apps/svc-catalog/src/ml/recompute.ts` (T-1012).
