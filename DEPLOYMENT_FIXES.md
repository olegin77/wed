# ะัะฟัะฐะฒะปะตะฝะธั ัะฐะทะฒะตัััะฒะฐะฝะธั WeddingTech

## ะะตะทัะผะต ะฒัะฟะพะปะฝะตะฝะฝัั ะธัะฟัะฐะฒะปะตะฝะธะน

ะัะต ะทะฐะฟัะพัะตะฝะฝัะต ะธัะฟัะฐะฒะปะตะฝะธั ะฑัะปะธ ััะฟะตัะฝะพ ะฟัะธะผะตะฝะตะฝั. ะะธะถะต ะฟัะธะฒะตะดะตะฝะพ ะฟะพะดัะพะฑะฝะพะต ะพะฟะธัะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน.

---

## 1. ะัะฟัะฐะฒะปะตะฝะธะต ะพัะธะฑะพะบ EADDRINUSE

### ะัะพะฑะปะตะผะฐ
ะัะธ ะฟะพะฒัะพัะฝะพะผ ะทะฐะฟััะบะต ัะตัะฒะธัะพะฒ ะฒะพะทะฝะธะบะฐะปะธ ะพัะธะฑะบะธ EADDRINUSE ะธะท-ะทะฐ ัะพะณะพ, ััะพ ะฟะพััั ะพััะฐะฒะฐะปะธัั ะทะฐะฝัััะผะธ ะฟัะตะดัะดััะธะผะธ ะฟัะพัะตััะฐะผะธ.

### ะะตัะตะฝะธะต
- ะะพะฑะฐะฒะปะตะฝะฐ ััะฝะบัะธั `check_and_free_port()` ะฒ `scripts/start-dev-full.sh`
- ะะตัะตะด ะทะฐะฟััะบะพะผ ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ ะฟัะพะฒะตััะตััั ะทะฐะฝััะพััั ะฟะพััะฐ ั ะฟะพะผะพััั `ss -lntp`
- ะัะปะธ ะฟะพัั ะทะฐะฝัั, ัะฝะฐัะฐะปะฐ ะฟััะฐะตะผัั ัะฑะธัั ะฟัะพัะตัั ะฟะพ PID ะธะท ัะฐะนะปะฐ
- ะะพะฟะพะปะฝะธัะตะปัะฝะพ ะธัะฟะพะปัะทัะตััั `lsof` ะดะปั ะฟะพะธัะบะฐ ะธ ะทะฐะฒะตััะตะฝะธั ะฟัะพัะตััะพะฒ ะฝะฐ ะทะฐะฝััะพะผ ะฟะพััั
- ะัะต PID ัะฐะนะปั ััะฐะฝัััั ะฒ `/run/wed/<service>.pid`

---

## 2. ะฃะฟัะฐะฒะปะตะฝะธะต PID ัะฐะนะปะฐะผะธ

### ะะทะผะตะฝะตะฝะธั ะฒ start-dev-full.sh
- ะกะพะทะดะฐะฝะธะต ะดะธัะตะบัะพัะธะธ `/run/wed` ะดะปั ััะฐะฝะตะฝะธั PID ัะฐะนะปะพะฒ
- ะัะธ ะทะฐะฟััะบะต ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ PID ะทะฐะฟะธััะฒะฐะตััั ะฒ ัะฐะนะป
- ะะพะฑะฐะฒะปะตะฝ `trap` ะดะปั ะบะพััะตะบัะฝะพะน ะพััะฐะฝะพะฒะบะธ ะฟะพ Ctrl+C
- ะคัะฝะบัะธั `cleanup()` ัะธัะฐะตั ะฒัะต PID ัะฐะนะปั ะธ ะบะพััะตะบัะฝะพ ะทะฐะฒะตััะฐะตั ะฟัะพัะตััั

### ะะทะผะตะฝะตะฝะธั ะฒ stop-dev-full.sh
- ะงัะตะฝะธะต PID ะธะท ัะฐะนะปะพะฒ ะฒ `/run/wed/`
- ะะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ะฟัะพัะตััะพะฒ ั ะฟะพะผะพััั `kill`
- ะัะธะฝัะดะธัะตะปัะฝะพะต ะทะฐะฒะตััะตะฝะธะต (`kill -9`) ะตัะปะธ ะฟัะพัะตัั ะฝะต ะทะฐะฒะตััะธะปัั
- ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ะธ ะพัะธััะบะฐ ะฟะพััะพะฒ ัะตัะตะท `lsof`
- ะฃะดะฐะปะตะฝะธะต PID ัะฐะนะปะพะฒ ะฟะพัะปะต ะพััะฐะฝะพะฒะบะธ

---

## 3. ะัะพัะปััะธะฒะฐะฝะธะต ะฝะฐ 0.0.0.0

### ะะตัะตะผะตะฝะฝะฐั HOST
- ะะพะฑะฐะฒะปะตะฝะฐ ะฟะตัะตะผะตะฝะฝะฐั `HOST=0.0.0.0` ะฒ `.env` ัะฐะนะป
- ะัะต ะผะธะบัะพัะตัะฒะธัั ัะถะต ัะปััะฐะปะธ ะฝะฐ `0.0.0.0` (ะฟัะพะฒะตัะตะฝะพ)
- Frontend ะทะฐะฟััะบะฐะตััั ั ัะปะฐะณะพะผ `-H ${HOST:-0.0.0.0}`
- ะะตัะตะผะตะฝะฝะฐั `HOST` ะฟะตัะตะดะฐะตััั ะฒ ะบะฐะถะดัะน ะผะธะบัะพัะตัะฒะธั ัะตัะตะท `npm start`

### next.config.mjs
- ะะพะฑะฐะฒะปะตะฝ `experimental.allowedDevOrigins` ั ัะฐะทัะตัะตะฝะฝัะผะธ ะธััะพัะฝะธะบะฐะผะธ:
  - `http://localhost:3000`
  - `http://127.0.0.1:3000`
  - `http://0.0.0.0:3000`

---

## 4. ะะพััะธะฝะณ ััะพะฝัะตะฝะดะฐ

### ะขะตะบััะตะต ัะพััะพัะฝะธะต
- ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ ะฝะฐัะพะดะธััั ะฒ `app/page.tsx` ะธ ะดะพัััะฟะฝะฐ ะฟะพ ะฟััะธ `/`
- ะะตั middleware ะธะปะธ ัะตะดะธัะตะบัะพะฒ, ะบะพัะพััะต ะฑั ะฟะตัะตะฝะฐะฟัะฐะฒะปัะปะธ ะฝะตะฐััะตะฝัะธัะธัะธัะพะฒะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะกััะฐะฝะธัะฐ ััะฟะตัะฝะพ ะทะฐะณััะถะฐะตััั ะฑะตะท ะฐะฒัะพ-ัะตะดะธัะตะบัะฐ ะฝะฐ `/dashboard`

### ะัะพะฒะตัะตะฝะพ
- `app/layout.tsx` - ะฑะฐะทะพะฒัะน layout ะฑะตะท ัะตะดะธัะตะบัะพะฒ
- `app/page.tsx` - ะดะพะผะฐัะฝัั ัััะฐะฝะธัะฐ ั ะผะฐัะบะตัะธะฝะณะพะฒัะผ ะบะพะฝัะตะฝัะพะผ
- ะััััััะฒะธะต middleware.ts ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ

---

## 5. Health-ัะตะบะธ

### ะะธะบัะพัะตัะฒะธัั
ะะพะฑะฐะฒะปะตะฝ/ะพะฑะฝะพะฒะปะตะฝ ัะฝะดะฟะพะธะฝั `GET /healthz` ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ:
- **svc-auth** (3001): `/healthz` โ `{"status":"ok"}`
- **svc-catalog** (3002): `/healthz` โ `{"status":"ok","db":true}`
- **svc-enquiries** (3003): `/healthz` โ `{"status":"ok","db":true}`
- **svc-billing** (3004): `/healthz` โ `{"status":"ok","service":"billing"}`
- **svc-vendors** (3005): `/healthz` โ `{"status":"ok","db":true}`
- **svc-guests** (3006): `/healthz` โ `{"status":"ok","db":true}`
- **svc-payments** (3007): `/healthz` โ `{"status":"ok"}`

### Frontend
- ะกะพะทะดะฐะฝ ัะฐะนะป `app/api/healthz/route.ts`
- ะญะฝะดะฟะพะธะฝั `GET /api/healthz` ะฒะพะทะฒัะฐัะฐะตั:
  ```json
  {
    "status": "ok",
    "timestamp": "2025-10-24T...",
    "service": "frontend"
  }
  ```

---

## 6. ะขะตััั

### Smoke ัะตััั (scripts/smoke.sh)
ะกะพะทะดะฐะฝ ัะบัะธะฟั `scripts/smoke.sh` ะบะพัะพััะน ะฟัะพะฒะตััะตั:
1. ะะปะฐะฒะฝัั ัััะฐะฝะธัั (/) - ะดะพะปะถะฝะฐ ัะพะดะตัะถะฐัั "WeddingTech"
2. Frontend health (`/api/healthz`) - ะดะพะปะถะตะฝ ะฒะตัะฝััั `{"status":"ok"}`
3. Health-ัะตะบะธ ะฒัะตั ะผะธะบัะพัะตัะฒะธัะพะฒ (3001-3007) - `/healthz`

ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
```bash
./scripts/smoke.sh
# ะธะปะธ
npm run test:smoke
```

### E2E ัะตััั (Playwright)
ะกะพะทะดะฐะฝ ัะตัั `e2e/homepage.spec.ts` ะบะพัะพััะน ะฟัะพะฒะตััะตั:
1. ะะฐะณััะทะบั ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัั ะฑะตะท ัะตะดะธัะตะบัะฐ
2. ะััััััะฒะธะต ะฐะฒัะพ-ัะตะดะธัะตะบัะฐ ะฝะฐ `/dashboard` ะฑะตะท ัะตััะธะธ
3. ะะฐะปะธัะธะต ัะฐะฑะพัะฐััะธั ะฝะฐะฒะธะณะฐัะธะพะฝะฝัั ัััะปะพะบ

ะกะพะทะดะฐะฝ `playwright.config.ts` ั ะบะพะฝัะธะณััะฐัะธะตะน:
- ะะฐะทะพะฒัะน URL: `http://localhost:3000`
- ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ dev-ัะตัะฒะตัะฐ ะฟะตัะตะด ัะตััะฐะผะธ
- ะะพะดะดะตัะถะบะฐ CI/CD ะพะบััะถะตะฝะธั

ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
```bash
npm run test:e2e        # ะะฐะฟััะบ ัะตััะพะฒ
npm run test:e2e:ui     # ะะฐะฟััะบ ั UI
```

---

## 7. ะะพัะฐัะธั ะปะพะณะพะฒ

### ะะตะฐะปะธะทะฐัะธั
ะ `start-dev-full.sh` ะดะพะฑะฐะฒะปะตะฝะฐ ัะพัะฐัะธั ะปะพะณะพะฒ:
- ะัะพะฒะตัะบะฐ ัะฐะทะผะตัะฐ ะปะพะณ-ัะฐะนะปะฐ ะฟะตัะตะด ะทะฐะฟะธััั
- ะัะปะธ ัะฐะทะผะตั > 5 ะะ, ัะพะทะดะฐะตััั ะฑัะบะฐะฟ
- ะฅัะฐะฝัััั ะดะพ 5 ัะพัะฐัะธะน (`.log.1`, `.log.2`, ..., `.log.5`)
- ะะพะณะธ ะทะฐะฟะธััะฒะฐัััั ะฒ `/tmp/<service>.log`

### ะะพะณะธ ัะตัะฒะธัะพะฒ
- `/tmp/svc-auth.log`
- `/tmp/svc-catalog.log`
- `/tmp/svc-enquiries.log`
- `/tmp/svc-billing.log`
- `/tmp/svc-vendors.log`
- `/tmp/svc-guests.log`
- `/tmp/svc-payments.log`
- `/tmp/next.log`

---

## 8. ะัะฟัะฐะฒะปะตะฝะธะต MODULE_TYPELESS_PACKAGE_JSON

### ะะตัะตะฝะธะต
ะะพะฑะฐะฒะปะตะฝะพ `"type": "module"` ะฒ ะบะพัะฝะตะฒะพะน `package.json`:
```json
{
  "name": "weddingtech-website",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  ...
}
```

ะญัะพ ััััะฐะฝัะตั ะฟัะตะดัะฟัะตะถะดะตะฝะธั ะพ typeless package.json ะฟัะธ ะทะฐะฟััะบะต.

---

## 9. ะัะพะณะพะฒะฐั ัะฐะฑะปะธัะฐ ะฟะพััะพะฒ

ะะพัะปะต ะทะฐะฟััะบะฐ `./scripts/start-dev-full.sh` ะฒัะฒะพะดะธััั ัะฐะฑะปะธัะฐ:

```
๐ ะะพัััะฟะฝัะต ัะตัะฒะธัั:

ะกะตัะฒะธั               URL                       ะกัะฐััั
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Frontend             http://localhost:3000     โ
Auth Service         http://localhost:3001     โ
Catalog Service      http://localhost:3002     โ
Enquiries            http://localhost:3003     โ
Billing              http://localhost:3004     โ
Vendors              http://localhost:3005     โ
Guests               http://localhost:3006     โ
Payments             http://localhost:3007     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
PostgreSQL           localhost:5434
MinIO Console        http://localhost:9001
```

---

## ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

### ะะฐะฟััะบ ัะตัะฒะธัะพะฒ
```bash
./scripts/start-dev-full.sh
```

### ะัะพะฒะตัะบะฐ ะฟะพััะพะฒ
```bash
ss -lntp | egrep ':(3000|3001|3002|3003|3004|3005|3006|3007)\s'
```

### ะัะพะฒะตัะบะฐ ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัั
```bash
curl -I http://127.0.0.1:3000/
# ะะถะธะดะฐะตััั: HTTP/1.1 200 OK
```

### ะะฐะฟััะบ smoke ัะตััะพะฒ
```bash
./scripts/smoke.sh
# ะะถะธะดะฐะตััั: โ ะะกะ ะขะะกะขะซ ะะะะะะะะซ
```

### ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ
```bash
./scripts/stop-dev-full.sh
# ะธะปะธ
Ctrl+C (ะฟัะธ ะทะฐะฟััะบะต ะฒ foreground ัะตะถะธะผะต)
```

---

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะปัััะตะฝะธั

1. **ะะตะทะพะฟะฐัะฝะพััั**: ะัะต ัะตัะฒะธัั ะธัะฟะพะปัะทััั `applySecurityHeaders()`
2. **Graceful shutdown**: ะะพะฑะฐะฒะปะตะฝะฐ ะพะฑัะฐะฑะพัะบะฐ SIGINT/SIGTERM ะดะปั ะบะพััะตะบัะฝะพะน ะพััะฐะฝะพะฒะบะธ
3. **ะะพะฝะธัะพัะธะฝะณ**: ะะพะถะฝะพ ะพััะปะตะถะธะฒะฐัั ััะฐััั ัะตัะตะท health-ัะตะบะธ
4. **ะะพะณะธัะพะฒะฐะฝะธะต**: ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝัะต ะปะพะณะธ ะฒ `/tmp/` ั ัะพัะฐัะธะตะน
5. **ะัะบะฐะทะพัััะพะนัะธะฒะพััั**: ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฟะพััะพะฒ ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต

---

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
/workspace/
โโโ scripts/
โ   โโโ start-dev-full.sh    # ะะฑะฝะพะฒะปะตะฝ: PID, ะฟะพััั, ัะพัะฐัะธั
โ   โโโ stop-dev-full.sh     # ะะฑะฝะพะฒะปะตะฝ: ััะตะฝะธะต PID, ะบะพััะตะบัะฝะฐั ะพััะฐะฝะพะฒะบะฐ
โ   โโโ smoke.sh             # ะะพะฒัะน: smoke ัะตััั
โโโ app/
โ   โโโ api/
โ   โ   โโโ healthz/
โ   โ       โโโ route.ts     # ะะพะฒัะน: health-check ััะพะฝัะตะฝะดะฐ
โ   โโโ layout.tsx           # ะะตะท ะธะทะผะตะฝะตะฝะธะน
โ   โโโ page.tsx             # ะะตะท ะธะทะผะตะฝะตะฝะธะน
โโโ e2e/
โ   โโโ homepage.spec.ts     # ะะพะฒัะน: E2E ัะตัั ะณะปะฐะฒะฝะพะน ัััะฐะฝะธัั
โโโ playwright.config.ts     # ะะพะฒัะน: ะบะพะฝัะธะณััะฐัะธั Playwright
โโโ next.config.mjs          # ะะฑะฝะพะฒะปะตะฝ: allowedDevOrigins
โโโ package.json             # ะะฑะฝะพะฒะปะตะฝ: type:module, playwright, scripts
โโโ .env                     # ะะฑะฝะพะฒะปะตะฝ: HOST=0.0.0.0

ะะธะบัะพัะตัะฒะธัั (ะพะฑะฝะพะฒะปะตะฝั health-ัะตะบะธ):
โโโ apps/svc-auth/src/
โ   โโโ main.js             # /healthz endpoint
โ   โโโ server.js           # /healthz endpoint
โโโ apps/svc-catalog/src/main.js
โโโ apps/svc-enquiries/src/main.js
โโโ apps/svc-billing/src/main.js
โโโ apps/svc-vendors/src/main.js
โโโ apps/svc-guests/src/main.js
โโโ apps/svc-payments/src/main.js
```

---

## ะกะปะตะดัััะธะต ัะฐะณะธ

1. ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ:
   ```bash
   npm install
   ```

2. ะะฐะฟัััะธัั ะฟัะพะตะบั:
   ```bash
   ./scripts/start-dev-full.sh
   ```

3. ะัะพะฒะตัะธัั smoke ัะตััั:
   ```bash
   ./scripts/smoke.sh
   ```

4. ะะฟัะธะพะฝะฐะปัะฝะพ: ัััะฐะฝะพะฒะธัั Playwright ะดะปั E2E ัะตััะพะฒ:
   ```bash
   npx playwright install
   npm run test:e2e
   ```

---

## ะะฐะบะปััะตะฝะธะต

ะัะต ะทะฐะฟัะพัะตะฝะฝัะต ะธัะฟัะฐะฒะปะตะฝะธั ะฑัะปะธ ััะฟะตัะฝะพ ะฟัะธะผะตะฝะตะฝั:
- โ ะัะฟัะฐะฒะปะตะฝั ะพัะธะฑะบะธ EADDRINUSE
- โ ะะพะฑะฐะฒะปะตะฝะพ ัะฟัะฐะฒะปะตะฝะธะต PID ัะฐะนะปะฐะผะธ
- โ ะะฐัััะพะตะฝะพ ะฟัะพัะปััะธะฒะฐะฝะธะต ะฝะฐ 0.0.0.0
- โ ะัะพะฒะตัะตะฝ ะธ ะฟะพะดัะฒะตัะถะดะตะฝ ัะพััะธะฝะณ ััะพะฝัะตะฝะดะฐ
- โ ะะพะฑะฐะฒะปะตะฝั health-ัะตะบะธ ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ
- โ ะกะพะทะดะฐะฝั smoke ะธ E2E ัะตััั
- โ ะะฐัััะพะตะฝะฐ ัะพัะฐัะธั ะปะพะณะพะฒ
- โ ะฃัััะฐะฝะตะฝั MODULE_TYPELESS ะฟัะตะดัะฟัะตะถะดะตะฝะธั
- โ ะะพะฑะฐะฒะปะตะฝะฐ ะธะฝัะพัะผะฐัะธะฒะฝะฐั ัะฐะฑะปะธัะฐ ะฟะพััะพะฒ

ะัะพะตะบั ะณะพัะพะฒ ะบ ัะฐะทัะฐะฑะพัะบะต ะธ ัะตััะธัะพะฒะฐะฝะธั!
